function compress(t){const e=8*(t.length+1),n=[..."\0"+t].map((t=>t.charCodeAt(0))),o=[];let r=1;const l=t=>{r=r<<1|t,r>=256&&(o.push(255&r),r=1)},h=(t,e)=>{for(e--;e>=0;e--)l(t&2**e?1:0)},s=t=>{const e=0|t/16,n=(t&=15)<4?0:t<8?1:2;for(let t=0;t<e;t++)h(3,2);h(n,2),h(t,2+n)};let f=e;for(;;){const t={};for(let e=0;e<n.length;e++)n[e]in t?t[n[e]]++:t[n[e]]=1;const e=Object.keys(t).map((e=>[parseInt(e),t[e]]));if(e.sort(((t,e)=>e[1]-t[1])),e[0][1]<7)break;const l=e[0][0],h=[];let g=-1,c=0;for(let t=0;t<n.length;t++)n[t]==l&&(h.push(0==h.length?t-c:t-c-g),g=t-c,c++);let u=0;for(let t=0;t<n.length-u;t++){for(;n[t+u]==l;)u++;n[t]=n[t+u]}n.length-=u,s(l),s(h.length);for(let t=0;t<h.length;t++)s(h[t]);const a=8*o.length+Math.floor(Math.log2(r))+8*n.length;if(a>=f){f=a;break}f=a}for(let t=0;t<n.length;t++)h(n[t],8);for(;1!=r;)l(0);return o}function decompress(t){let e=0,n=0;const o=()=>{const o=0==(t[n]&2**(7-e))?0:1;return 8==++e&&(e=0,n++),o},r=t=>{let e=0;for(t--;t>=0;t--)e=e<<1|o();return e},l=t=>{const o=r(t);for(e-=t;e<0;)e+=8,n--;return 0==o},h=()=>{let t=0,e=r(2);for(;3==e;)t+=16,e=r(2);return t+=r(e+2),t},s=[];for(;!l(8);){const t=h(),e=h(),n=new Array(e);for(let t=0;t<e;t++)n[t]=h();s.push([n,t])}r(8);const f=[];for(;n<t.length;)f.push(r(8));0==f[f.length-1]&&f.splice(-1,1);for(let t=s.length-1;t>=0;t--){const e=s[t][1],n=s[t][0];f.length+=n.length;for(let t=0,e=-1;t<n.length;t++)n[t]=e+=n[t];let o=n.length,r=1,l=n.length-1;for(;n[l]==f.length-n.length;)f[f.length-r]=e,o--,l--,r++;for(r=f.length-r;r>=0;r--)f[r]=f[r-o],r-o==n[l]&&(f[r-o--]=e,l--)}return f.map((t=>String.fromCharCode(t))).join("")}
console.log(decompress(compress("Hello, world!")))