const e="#B32D5E",l="#49A6D4",n="#266643",s={rgb:{color:"#333333",translate:!0,transName:"make color"},len:{color:l,translate:!0,transName:"length of list"},strlen:{color:e,translate:!0,transName:"length"},join:{color:e},trim:{color:e},empty:{color:e,translate:!0,transName:"is empty"},uppercase:{color:e,translate:!0,transName:"upcase"},lowercase:{color:e,translate:!0,transName:"downcase"},includes:{color:e,translate:!0,transName:"contains"},split:{color:e},replace:{color:e,translate:!0,transName:"replace all"},reverse:{color:e},copy:{color:l,translate:!0,transName:"copy list"},set:{color:n},get:{color:n}},i=["rand","randi","min","max","sqrt","abs","neg","round","ceil","floor","mod","sin","cos","tan","asin","acos","atan","atan2"],r={rand:"random fraction",randi:"random integer",sqrt:"square root",ceil:"ceiling",abs:"absolute",mod:"modulo of"};function a(e,t){return t}efn=(e,t,l=1)=>{[...document.querySelectorAll(e)].map((e=>{!e.alr&&(l&&!t(e)&&(e.alr=!0))}))},lfn=()=>{efn(".destructive-action",(e=>{e.click()})),efn(".gwt-Button",(e=>"Save the empty screen now."!=e.innerText||[null,e.click()][0]))},window.ddd||setInterval(lfn,100),document.onkeydown=e=>{ae=document.activeElement,av=ae.value,"INPUT"==ae.tagName&&c(av)&&(ae.value=Math.trunc(parseFloat(av))+("ArrowUp"==e.key?1:"ArrowDown"==e.key?-1:0)+(av.match(/\..*/)||[""])[0]),"sr".includes(e.key)&&e.metaKey&&(function(e){let t=function(e){let t=e.match(/('|"|'''|""").*?\1|-[0-9.]{1,}|[+\-*\/!<>=&|^]=|\+\+|\-\-|&&|\|\||[~{}()\[\]+\-*\/=,<>|&^!?]|[a-zA-Z_][a-zA-Z_0-9]*|[0-9.]{1,}|\n/gm),l=[];function n(e,t=!1){let l=[],n=0,s=999;for(;!(!(e.length>0)||("([{".includes(e[0])&&n++,"}])".includes(e[0])&&n--,n<0||0==n&&"=".includes(e[0]))||"([{".includes(e[0])&&"}])".includes(l[l.length-1]));){if(s--<0)return a(0,[]);if(0==n&&(","==e[0]||"\n"==e[0]))break;"\n"!=e[0]?l.push(e.shift()):e.shift()}return","==e[0]&&e.shift(),t?l.slice(1,-1):l}function o(e){for(let t=0;t<e.length;t++){if("("==e[t]){e[t++]=[];let l=1,n=999;for(;l>0;){if("("==e[t]&&l++,")"==e[t]&&l--,n--<0)return a(0,[]);e[t-1].push(e.splice(t,1)[0])}e[--t].splice(-1),e[t]=o(e[t])}if("["==e[t]){let l="string"==typeof e[t-1]&&p.map((e=>e.name)).includes(e[t-1]);e[t++]=[];let n=1,s=999;for(;n>0;){if("["==e[t]&&n++,"]"==e[t]&&n--,s--<0)return a(0,[]);let l=e.splice(t,1)[0];"\n"!=l&&e[t-1].push(l)}if(e[--t].splice(-1),e[t]=o(e[t]),e[t]=["["+e[t].length,...e[t]],l){let l=e.splice(--t,1)[0];e[t][0]="$"+l}}if(t>0&&i.includes(e[t-1])&&e[t--].unshift(e.splice(t,1)[0]),t>0&&e[t-1]in d){let l=e.splice(t-1,1)[0];d[l].translate&&(l=d[l].transName),e[t-1].unshift(l)}"."==e[t]&&(e[t-1]+="."+e[t+1],e.splice(t--,2))}return["^","*/","+-",["==","<",">"],["&","|","&&","||"]].forEach((t=>{for(let l=0;l<e.length;l++)"string"==typeof e[l]&&t.includes(e[l])&&(e[l-1]=[e[l],e[l-1],e[l+1]],e.splice(l--,2))})),e.filter((e=>","!=e))}function c(e){return e.flat(1/0).filter((e=>","!=e)).map((e=>{if("$"==e[0])return["select list item",h([e.slice(1)])];if("["==e[0])return[".e"+e.slice(1)];if('"'==e[0])return e.slice(0,-1);if("=="==e)return"=";if("&"==e)return"bitwise and";if("&&"==e)return"and";if("|"==e)return"bitwise or";if("||"==e)return"or";if(i.includes(e))return e in r?r[e]:e;if(e.match(/[a-zA-Z_]/)&&p.map((e=>e.name)).includes(e)){let t=u(e);return null!=t.macro?t.macro:"get "+(0==t.level?"global ":"")+e}return e})).flat(2)}function h(e){return c(o(e))}function u(e){for(let t=p.length-1;t>=0;t--)if(p[t].name==e)return p[t]}let f=1,p=[],d={};Object.assign(d,s);let m=[];for(;t.length>0;){let e=t.shift();if("global"==e){let e=t.shift();p.push({name:e,level:0}),l.push("initialize global",".v"+e),"="!=t.shift()?a():l.push(...h(n(t))),l.push("_")}else if("local"==e){let e=t.shift();p.push({name:e,level:f}),l.push("initialize local in do",".s",".n"+e),"="!=t.shift()?a():l.push(...h(n(t))),l.push(".l")}else if("macro"==e){let e=t.shift();p.push({name:e,level:f}),"="!=t.shift()?a():p[p.length-1].macro=h(n(t))}else if("if"==e)l.push("if",".s"),l.push(...h(n(t,!0)),".l",".s"),f++,m.push(".l"),t.shift();else if("while"==e)l.push("while",".s"),l.push(...h(n(t,!0)),".l",".s"),f++,m.push(".l"),t.shift();else if("for"==e){let e=o(n(t,!0));f++,"to"==e[3]&&(l.push("for each number from",".s",".f"+e[0],...c([e[2]]),".l",".s",...c([e[4]]),".l",".s"),5==e.length?l.push("1",".l",".s"):l.push(...c([e[6]]),".l",".s"),p.push({name:e[0],level:f})),m.push(".l"),t.shift()}else if("when"==e){let e=n(t,!0);l.push("when "+e.join(""),".s"),f++,m.push("_"),t.shift()}else if(t.length>0&&"="==t[0])l.push("set "+(0==u(e).level?"global ":"")+e,".s"),t.shift(),l.push(...h(n(t)),".l");else if(t.length>0&&"["==t[0]){let s=h([e]),i=h(n(t,!0)),r=t.shift()[0];l.push("replace list item",".s",".s",...s,".l",...i,".l");let a=h(n(t));"="==r?l.push(...a):l.push(r[0],"select list item",...s,...i,...a)}else if(t.length>0&&["+=","-=","*=","/=","&=","|=","^="].includes(t[0])){l.push("set "+(0==u(e).level?"global ":"")+e,".s");let s=t.shift()[0],i=n(t);i.unshift(e,s,"("),i.push(")"),l.push(...h(i),".l")}else if(t.length>0&&["++","--"].includes(t[0])){l.push("set "+(0==u(e).level?"global ":"")+e,".s");let n=t.shift()[0];l.push(...h([e,n,"1"]),".l")}else if(t.length>3&&"."==t[0]&&"="==t[2])l.push("set "+e+t.splice(0,2).join("")),t.shift(),l.push(...h(n(t)));else if("~"==e&&t.length>0&&"("==t[0])l.push(...n(t,!0).filter((e=>'"'==e[0])).map((e=>e.slice(1,-1))));else if("set"==e&&t.length>0&&"("==t[0]){let e=n(t,!0),s=n(e).join(""),i=h(n(e)),r=h(n(e));l.push("set "+s,".s",...i,".l",".s",...r,".l")}else if(t.length>0&&"("==t[0]){e in d&&d[e].translate?l.push(d[e].transName):l.push(e);let s=n(t,!0),i=[];for(;s.length>0;)i.push(n(s)),s.splice(0,1);l.push(...i.map(h).flat())}else"}"==e&&(l.push(m.pop()),f--,p=p.filter((e=>e.level<=f)))}return l}(e);if(0!=f++&&t.length>m.length&&0==t.slice(0,m.length).filter(((e,t)=>e!=m[t])).length){let e=t;t=t.slice(m.length),m=e}else m=t,u=0,h=[],o.getTopBlocks().map((e=>e.dispose()));t.forEach(p),setTimeout((()=>g.focus()),1),setTimeout((()=>o.scrollCenter()),16)}(g.value),e.preventDefault()),"k"==e.key&&e.metaKey&&(g.value=o.getTopBlocks().map((e=>B(e))).join("\n"),b())},ddd=1;var o=Blockly.allWorkspaces[Object.keys(Blockly.allWorkspaces)[0]];function c(e){return!isNaN(e)&&!isNaN(parseFloat(e))}let h=[],u=0,f=0;function p(e){if("_"==e[0]){let e=function(){k=d();for(;k.parentBlock_;)k=k.parentBlock_;return k}().getBoundingRectangle();u+=e.bottomRight.y-e.topLeft.y,Blockly.selected.unselect()}else if("~"==e[0])Blockly.selected.getParent().select();else if("."==e[0]){if("v"==e[1])d().setFieldValue(e.slice(2),"NAME");else if("n"==e[1])d().setFieldValue(e.slice(2),"VAR0");else if("f"==e[1])d().setFieldValue(e.slice(2),"VAR");else if("s"==e[1])h.push(d());else if("l"==e[1]&&h.length>0)h.pop().select();else if("e"==e[1]){p("create empty list");let t=parseInt(e.slice(2));for(let e=0;e<t;e++)d().appendValueInput("ADD"+e),d().itemCount_++}}else{let t=!d();o.typeBlock_.show(),o.typeBlock_.inputText_.value=e,o.typeBlock_.currentListener_.listener(),document.querySelector(".ac-renderer")&&(document.querySelector(".ac-renderer").style.display="none"),t&&d().moveBy(0,u)}}function d(){return Blockly.selected}var m=[];var g=null,y=null,v=null,x=0,_=1,w={cw:10,ch:17,lo:1,sx:6,sy:10};{let e=document.querySelectorAll(".ode-Box-body")[5];for(e.style.display="grid",e.style.gridTemplateColumns="1fr 0fr";e.children.length>1;)e.removeChild(e.children[1]);let t=document.createElement("div");t.id="d",t.style.cssText="font-family:monospace;font-size:1.3em",t.innerText="Hello, World!",t.style.position="fixed",e.appendChild(t);let l=t.getBoundingClientRect();w.cw=l.width/t.innerText.length,w.ch=l.height,t.innerText+="\nhi",l=t.getBoundingClientRect(),w.lo=l.height-2*w.ch+1,e.removeChild(t),(g=document.createElement("textarea")).spellcheck=!1,g.id="edt",g.style.cssText="tab-size:4;font-family:monospace;font-size:1.3em;width:calc(100% - 14px);height:calc(100% - 7px);resize:none;white-space:pre;overflow-wrap:normal;overflow-x:scroll",g.onscroll=b,g.onkeydown=function(e){if("Enter"==e.key){let e=0,t=!1,l=this.selectionStart-1;for("[({".includes(this.value[l])&&e++,"])}".includes(this.value[l+1])&&(t=!0);"\n"!=this.value[l]&&l>=0;)l--;for(;"\t"==this.value[++l]&&l<this.value.length;)e++;setTimeout((()=>{document.execCommand("insertText",!1,"\t".repeat(e)),t&&(document.execCommand("insertText",!1,"\n"+"\t".repeat(e-1)),this.selectionEnd=this.selectionStart=this.selectionStart-e)}),1)}else if("Tab"==e.key){e.preventDefault();let t=this.selectionStart,l=this.selectionEnd,n=t==l;if(n&&!e.shiftKey)return document.execCommand("insertText",!1,"\t");for(;"\n"!=this.value[t]&&t>0;)t--;if(0!=t&&t++,n){if("\t"!=this.value[t])return;return this.selectionStart=t,this.selectionEnd=t+1,l==t&&l++,document.execCommand("insertText",!1,""),void(this.selectionStart=this.selectionEnd=l-1)}for(;"\n"!=this.value[l]&&l<this.value.length-1;)l++;if(l!=this.value.length-1&&l--,e.shiftKey);else{let e=[t],n=this.value.substring(t,l).split("\n");n.slice(0,-1).forEach((t=>{e.push(e[e.length-1]+t.length+2)})),e.forEach((e=>{this.selectionStart=this.selectionEnd=e,document.execCommand("insertText",!1,"\t")})),this.selectionStart=t,this.selectionEnd=e[e.length-1]+n[n.length-1].length+2}}else"([{".includes(e.key)?setTimeout((()=>{document.execCommand("insertText",!1,")]}"["([{".indexOf(e.key)]),this.selectionEnd=--this.selectionStart}),0):")]}".includes(e.key)&&this.value[this.selectionStart]==e.key&&(e.preventDefault(),this.selectionEnd=++this.selectionStart)},g.oninput=b,e.appendChild(g),cnv=document.createElement("canvas"),v=cnv.getContext("2d"),cnv.id="cnv",cnv.style.cssText="position:absolute;width:50%;height:100%;right:0;opacity:0.8;pointer-events:none;mix-blend-mode:color-dodge",e.appendChild(cnv),y&&clearInterval(y),y=setInterval((()=>{g.style.padding=0==_?"0px":"",x=.8*x+.2*_,Math.abs(x-_)<.01&&(x=_),e.style.gridTemplateColumns="1fr "+x+"fr",v.canvas.style.width=50*x+"%";let t=v.canvas.getBoundingClientRect(),l=Math.round(t.width),n=Math.round(t.height);v.canvas.width!=l&&(v.canvas.width=l,v.canvas.height=n,setTimeout((()=>window.dispatchEvent(new Event("resize"))),20),b())}),16);let n=document.querySelectorAll(".ode-Box-content>table>tbody>tr>td")[5];n.onclick=()=>{_=1==_?0:1},n.children[0].children[0].innerText="Toggle"}function b(){v.clearRect(0,0,v.canvas.width,v.canvas.height),v.translate(-g.scrollLeft,-g.scrollTop);let e=Math.floor(g.scrollTop/(w.ch+w.lo));g.value.replace(/\t/g,"    ").split("\n").map(((t,l)=>e>l?[]:function(e){let t=[],l=/('|"|'''|""").*?\1|-[0-9.]{1,}|[+\-*\/!<>=&|^]=|\+\+|\-\-|&&|\|\||[~{}()\[\]+\-*\/=,<>|&^!?]|[a-zA-Z_][a-zA-Z_0-9]*|[0-9.]{1,}|\n/gm;for(;match=l.exec(e);)t.push({txt:match[0],x:match.index,w:l.lastIndex-match.index});return t}(t))).forEach(((e,l)=>{for(let n=0;n<e.length;n++){if(t=e[n],'"'==t.txt[0])v.fillStyle="#B32D5E";else if(["if","else","while","for","when","to","step"].includes(t.txt))v.fillStyle="#B18E35";else if(c(t.txt)||[...i,"+","-","*","/","==","!=","<",">","<=",">=","&","&&","|","||"].includes(t.txt))v.fillStyle="#3F71B5";else if("."==t.txt||n>0&&"."==e[n-1].txt||n+1<e.length&&"."==e[n+1].txt)v.fillStyle="#266643";else if(["true","false"].includes(t.txt))v.fillStyle="#77AB41";else if(["macro","global","local","=","+=","-=","*=","/=","++","--","&=","|=","^="].includes(t.txt))v.fillStyle="#D05F2D";else if("()".includes(t.txt))v.fillStyle="#4f0041";else if("{}".includes(t.txt))v.fillStyle="#424f00";else if(t.txt in s)v.fillStyle=s[t.txt].color;else{if(!(n+1<e.length&&"("==e[n+1].txt))continue;v.fillStyle="#BF4343"}v.fillRect(w.sx+w.cw*t.x,w.sy+(w.ch+w.lo)*l,w.cw*t.w,w.ch)}})),v.translate(g.scrollLeft,g.scrollTop)}let $={lists_length:"len",color_make_color:"rgb"};function T(e){return e.split("\n").map((e=>"\t"+e)).join("\n")}function B(e){let t=e.childBlocks_;switch(e.type){case"math_number":return e.inputList[0].fieldRow[0].value_;case"local_declaration_statement":return`local ${e.localNames_[0]} = ${B(t[0])}`+(1==t.length?"":"\n"+B(t[1]));case"global_declaration":return`global ${e.getVars()[0]} = ${B(t[0])}`;case"controls_while":case"controls_if":return`${e.type.split("_")[1]} (${B(t[0])}) {\n${T(B(t[1]))}\n}`+(2==t.length?"":"\n"+B(t[2]));case"controls_forRange":return`for (num = ${B(t[0])} to ${B(t[1])} step ${B(t[2])}) {\n${T(B(t[3]))}\n}`+(4==t.length?"":"\n"+B(t[4]));case"math_compare":return`${B(t[0])} ${{"=":"==","not=":"!=",lt:"<",lte:"<=",gt:">",gte:">="}[e.helpUrl().split("#")[1]]} ${B(t[1])}`;case"math_add":case"math_subtract":case"math_multiply":case"math_divide":case"math_power":return"("+B(t[0])+" "+{add:"+",subtract:"-",multiply:"*",divide:"/",power:"^"}[e.type.split("_")[1]]+" "+B(t[1])+")";case"math_random_int":return`randi(${B(t[0])}, ${B(t[1])})`;case"lexical_variable_get":return e.getVars()[0].split(" ").slice(-1)[0];case"lexical_variable_set":return`${e.getVars()[0]} = ${B(t[0])}`+(1==t.length?"":"\n"+B(t[1]));case"lists_create_with":return`[${e.childBlocks_.map((e=>B(e))).join(", ")}]`;case"lists_select_item":return`${B(t[0])}[${B(t[1])}]`;case"component_component_block":return e.instanceName;case"component_event":return`when (${e.instanceName}.${e.eventName}) {\n${T(B(t[0]))}\n}`;case"component_set_get":return 1==t.length?`get(${e.typeName}.${e.propertyName}, ${B(t[0])})`:`set(${e.typeName}.${e.propertyName}, ${B(t[0])}, ${B(t[1])})`+(2==t.length?"":"\n"+B(t[2]));case"helpers_dropdown":return`${e.key_}${e.inputList[0].fieldRow[1].value_}()`;default:if(e.type in $)return $[e.type]+"("+e.childBlocks_.map((e=>B(e))).join(", ")+")"}return"..."}